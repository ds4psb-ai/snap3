# ğŸ“ˆ T3 Terminal (VDP/8082) - Phase 2B ìƒì„¸ ëª…ë ¹ì–´

**ì˜ì¡´ì„±**: T1 ì™„ë£Œ ì‹ í˜¸ `.t1-phase2a-done` í™•ì¸ í•„ìˆ˜  
**ì‹¤í–‰ ë°©ì‹**: âš¡ ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥ (T2ì™€ ë™ì‹œ)  
**ì‘ì—… ì‹œê°„**: 15ë¶„ ì˜ˆìƒ

---

## ğŸ” **ì‚¬ì „ ì¤€ë¹„ (í•„ìˆ˜)**

### **Step 1: T1 ì™„ë£Œ ì‹ í˜¸ í™•ì¸**
```bash
cd /Users/ted/snap3

# T1 ì™„ë£Œ ì‹ í˜¸ í™•ì¸
ls .t1-phase2a-done && echo "âœ… T1 ì¤€ë¹„ë¨ - T3 ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì‹œì‘" || echo "â³ T1 ëŒ€ê¸° ì¤‘"
```

### **Step 2: T3 ë””ë ‰í† ë¦¬ í™•ì¸**
```bash
cd /Users/ted/snap3/services/t2-extract

# ë””ë ‰í† ë¦¬ í™•ì¸
pwd  # /Users/ted/snap3/services/t2-extract í™•ì¸ í•„ìˆ˜

# T3 í¬íŠ¸ í™•ì¸ (8082 ì‚¬ìš© ì¤‘ì´ì–´ì•¼ í•¨)
lsof -i :8082 && echo "âœ… T3 ì„œë²„ ì‹¤í–‰ ì¤‘" || echo "âŒ T3 ì„œë²„ ì—†ìŒ - ì‹œì‘ í•„ìš”"
```

---

## ğŸ“Š **ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (ë©”ì¸ ì‘ì—…)**

### **Step 3: T1 Circuit Breaker ë©”íŠ¸ë¦­ ì—°ë™**
```bash
cd /Users/ted/snap3/services/t2-extract

echo "ğŸ“ˆ [T3] T1 Circuit Breaker ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì‹œì‘"

# Circuit Breaker ìƒíƒœ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
cat > circuit-breaker-metrics-monitor.sh << 'EOF'
#!/bin/bash

echo "ğŸ“Š Circuit Breaker ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì‹œì‘"
echo "ğŸ”— Target: T1 localhost:8080/api/circuit-breaker/status"

METRICS_FILE="circuit-breaker-metrics.json"
INTERVAL=5  # 5ì´ˆ ê°„ê²©

# ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í—¤ë”
echo "timestamp,state,failure_count,retry_attempts,success_rate,avg_response_time" > circuit-breaker-metrics.csv

echo "ğŸ“ˆ ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì‹œì‘ (5ì´ˆ ê°„ê²©)"

while true; do
    TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
    
    # T1 Circuit Breaker API í˜¸ì¶œ
    RESPONSE=$(curl -s http://localhost:8080/api/circuit-breaker/status 2>/dev/null)
    
    if [ $? -eq 0 ] && [ -n "$RESPONSE" ]; then
        # JSON íŒŒì‹±
        STATE=$(echo "$RESPONSE" | jq -r '.state.state // "UNKNOWN"')
        FAILURE_COUNT=$(echo "$RESPONSE" | jq -r '.state.failureCount // 0')
        RETRY_ATTEMPTS=$(echo "$RESPONSE" | jq -r '.state.retryAttempts // 0')
        SUCCESS_RATE=$(echo "$RESPONSE" | jq -r '.performance_metrics.success_rate // "0%"')
        AVG_RESPONSE=$(echo "$RESPONSE" | jq -r '.performance_metrics.avg_response_time // "0ms"')
        
        # CSV ë¡œê·¸
        echo "$TIMESTAMP,$STATE,$FAILURE_COUNT,$RETRY_ATTEMPTS,$SUCCESS_RATE,$AVG_RESPONSE" >> circuit-breaker-metrics.csv
        
        # ì‹¤ì‹œê°„ ì½˜ì†” ì¶œë ¥
        echo "[$TIMESTAMP] State: $STATE | Failures: $FAILURE_COUNT | Retries: $RETRY_ATTEMPTS | Success: $SUCCESS_RATE"
        
        # ìƒíƒœ ë³€í™” ê°ì§€
        if [ "$STATE" = "OPEN" ]; then
            echo "ğŸš¨ [T3] Circuit Breaker OPEN ìƒíƒœ ê°ì§€! ì•Œë¦¼ ì „ì†¡"
            echo "$(date): CIRCUIT_BREAKER_OPEN,$FAILURE_COUNT,$RETRY_ATTEMPTS" >> circuit-breaker-alerts.log
        elif [ "$STATE" = "HALF_OPEN" ]; then
            echo "âš ï¸ [T3] Circuit Breaker HALF_OPEN ìƒíƒœ - ë³µêµ¬ ì‹œë„ ì¤‘"
        fi
        
        # JSON ë©”íŠ¸ë¦­ ì €ì¥ (ë§ˆì§€ë§‰ ìƒíƒœ)
        echo "$RESPONSE" > "$METRICS_FILE"
        
    else
        echo "âŒ [T3] T1 Circuit Breaker API ì‘ë‹µ ì—†ìŒ"
        echo "$TIMESTAMP,ERROR,0,0,0%,0ms" >> circuit-breaker-metrics.csv
    fi
    
    sleep $INTERVAL
done
EOF

chmod +x circuit-breaker-metrics-monitor.sh
```

### **Step 4: ë°±ê·¸ë¼ìš´ë“œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì‹œì‘**
```bash
cd /Users/ted/snap3/services/t2-extract

# ë°±ê·¸ë¼ìš´ë“œë¡œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì‹œì‘
echo "ğŸš€ [T3] Circuit Breaker ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë°±ê·¸ë¼ìš´ë“œ ì‹œì‘"
./circuit-breaker-metrics-monitor.sh > metrics-monitor.log 2>&1 &

# ë©”íŠ¸ë¦­ ìˆ˜ì§‘ PID ì €ì¥
METRICS_PID=$!
echo "$METRICS_PID" > .t3-metrics-pid

echo "âœ… [T3] ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì‹œì‘ - PID: $METRICS_PID"
```

### **Step 5: P95 ì‘ë‹µì‹œê°„ ì‹¤ì‹œê°„ ê³„ì‚°**
```bash
cd /Users/ted/snap3/services/t2-extract

# P95 ì‘ë‹µì‹œê°„ ê³„ì‚° ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
cat > p95-calculator.sh << 'EOF'
#!/bin/bash

echo "ğŸ“Š P95 ì‘ë‹µì‹œê°„ ì‹¤ì‹œê°„ ê³„ì‚° ì‹œì‘"

RESPONSE_TIMES_FILE="response-times.log"
P95_RESULTS_FILE="p95-results.json"

while true; do
    # T1 API ì‘ë‹µì‹œê°„ ì¸¡ì • (10íšŒ)
    echo "â±ï¸ API ì‘ë‹µì‹œê°„ ì¸¡ì • ì¤‘..."
    
    for i in {1..10}; do
        START_TIME=$(date +%s%3N)  # ë°€ë¦¬ì´ˆ
        
        curl -s http://localhost:8080/api/health > /dev/null 2>&1
        
        END_TIME=$(date +%s%3N)
        RESPONSE_TIME=$((END_TIME - START_TIME))
        
        echo "$RESPONSE_TIME" >> "$RESPONSE_TIMES_FILE"
        echo "[$i/10] ì‘ë‹µì‹œê°„: ${RESPONSE_TIME}ms"
        
        sleep 0.5
    done
    
    # P95 ê³„ì‚° (ìµœê·¼ 100ê°œ ë°ì´í„°)
    if [ -f "$RESPONSE_TIMES_FILE" ]; then
        P95_VALUE=$(tail -n 100 "$RESPONSE_TIMES_FILE" | sort -n | awk 'BEGIN{c=0} {arr[c]=$1; c++} END{print arr[int(c*0.95)]}')
        P50_VALUE=$(tail -n 100 "$RESPONSE_TIMES_FILE" | sort -n | awk 'BEGIN{c=0} {arr[c]=$1; c++} END{print arr[int(c*0.50)]}')
        AVG_VALUE=$(tail -n 100 "$RESPONSE_TIMES_FILE" | awk '{sum+=$1} END{print int(sum/NR)}')
        
        echo "ğŸ“Š [T3] P95: ${P95_VALUE}ms | P50: ${P50_VALUE}ms | AVG: ${AVG_VALUE}ms"
        
        # JSON ê²°ê³¼ ì €ì¥
        cat > "$P95_RESULTS_FILE" << JSON_EOF
{
    "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
    "metrics": {
        "p95_response_time_ms": $P95_VALUE,
        "p50_response_time_ms": $P50_VALUE,
        "avg_response_time_ms": $AVG_VALUE,
        "sample_count": 100
    },
    "target": {
        "p95_threshold": 500,
        "status": "$( [ $P95_VALUE -lt 500 ] && echo "PASS" || echo "FAIL" )"
    }
}
JSON_EOF
        
        # ì„±ëŠ¥ ì„ê³„ê°’ ì²´í¬
        if [ "$P95_VALUE" -gt 500 ]; then
            echo "âš ï¸ [T3] P95 ì‘ë‹µì‹œê°„ ì„ê³„ê°’ ì´ˆê³¼: ${P95_VALUE}ms > 500ms"
        fi
    fi
    
    sleep 10
done
EOF

chmod +x p95-calculator.sh
```

### **Step 6: P95 ê³„ì‚° ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰**
```bash
cd /Users/ted/snap3/services/t2-extract

# P95 ê³„ì‚° ë°±ê·¸ë¼ìš´ë“œ ì‹œì‘
echo "ğŸ“Š [T3] P95 ì‘ë‹µì‹œê°„ ê³„ì‚° ë°±ê·¸ë¼ìš´ë“œ ì‹œì‘"
./p95-calculator.sh > p95-monitor.log 2>&1 &

# P95 ê³„ì‚° PID ì €ì¥
P95_PID=$!
echo "$P95_PID" > .t3-p95-pid

echo "âœ… [T3] P95 ê³„ì‚° ì‹œì‘ - PID: $P95_PID"
```

---

## ğŸ“Š **ì‹¤ì‹œê°„ ìƒíƒœ ëª¨ë‹ˆí„°ë§**

### **Step 7: ì¢…í•© ìƒíƒœ ëŒ€ì‹œë³´ë“œ**
```bash
cd /Users/ted/snap3/services/t2-extract

echo "ğŸ“Š [T3] ì‹¤ì‹œê°„ Circuit Breaker + P95 ëŒ€ì‹œë³´ë“œ"

# ì‹¤ì‹œê°„ ìƒíƒœ ì¶œë ¥ (30ì´ˆê°„)
for i in {1..6}; do
    echo "====== T3 ìƒíƒœ ë¦¬í¬íŠ¸ [$i/6] ======"
    echo "ğŸ• $(date)"
    
    # Circuit Breaker ìƒíƒœ
    echo "ğŸ”„ Circuit Breaker:"
    curl -s http://localhost:8080/api/circuit-breaker/status | jq '{
        state: .state.state,
        failures: .state.failureCount,
        success_rate: .performance_metrics.success_rate
    }' 2>/dev/null || echo "âŒ API ì‘ë‹µ ì—†ìŒ"
    
    # P95 ìµœì‹  ê²°ê³¼
    echo "ğŸ“Š P95 ë©”íŠ¸ë¦­:"
    if [ -f p95-results.json ]; then
        cat p95-results.json | jq '.metrics'
    else
        echo "â³ P95 ë°ì´í„° ìˆ˜ì§‘ ì¤‘..."
    fi
    
    # í”„ë¡œì„¸ìŠ¤ ìƒíƒœ
    echo "âš™ï¸ ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤:"
    echo "ë©”íŠ¸ë¦­ ìˆ˜ì§‘: $(kill -0 $(cat .t3-metrics-pid 2>/dev/null) 2>/dev/null && echo "ì‹¤í–‰ì¤‘" || echo "ì¤‘ë‹¨ë¨")"
    echo "P95 ê³„ì‚°: $(kill -0 $(cat .t3-p95-pid 2>/dev/null) 2>/dev/null && echo "ì‹¤í–‰ì¤‘" || echo "ì¤‘ë‹¨ë¨")"
    
    echo "---"
    sleep 5
done

echo "âœ… [T3] 30ì´ˆ ëª¨ë‹ˆí„°ë§ ì™„ë£Œ"
```

---

## âœ… **T3 ì™„ë£Œ ì¡°ê±´ ë° ì‹ í˜¸**

### **Step 8: ì™„ë£Œ ê²€ì¦ ë° ì‹ í˜¸ ìƒì„±**
```bash
cd /Users/ted/snap3/services/t2-extract

echo "ğŸ” [T3] Phase 2B ì™„ë£Œ ì¡°ê±´ ê²€ì¦"

# ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ìƒíƒœ í™•ì¸
if kill -0 $(cat .t3-metrics-pid 2>/dev/null) 2>/dev/null; then
    echo "âœ… ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í”„ë¡œì„¸ìŠ¤ ì •ìƒ ì‹¤í–‰ ì¤‘"
else
    echo "âŒ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨ë¨"
fi

# P95 ê³„ì‚° ìƒíƒœ í™•ì¸
if kill -0 $(cat .t3-p95-pid 2>/dev/null) 2>/dev/null; then
    echo "âœ… P95 ê³„ì‚° í”„ë¡œì„¸ìŠ¤ ì •ìƒ ì‹¤í–‰ ì¤‘"
else
    echo "âŒ P95 ê³„ì‚° í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨ë¨"
fi

# ë°ì´í„° íŒŒì¼ í™•ì¸
ls -la circuit-breaker-metrics.csv p95-results.json 2>/dev/null && echo "âœ… ë©”íŠ¸ë¦­ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ" || echo "â³ ë°ì´í„° ìˆ˜ì§‘ ì§„í–‰ ì¤‘"

# T3 ì™„ë£Œ ì‹ í˜¸ ìƒì„±
echo "âœ… T3 Circuit Breaker ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì™„ë£Œ" > /Users/ted/snap3/.t3-phase2b-done
echo "âœ… [T3] Phase 2B ì™„ë£Œ - ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í™œì„±í™”ë¨"
```

---

## ğŸ“Š **ë©”íŠ¸ë¦­ ê²°ê³¼ ìš”ì•½**

### **Step 9: ìˆ˜ì§‘ëœ ë°ì´í„° ìš”ì•½**
```bash
cd /Users/ted/snap3/services/t2-extract

echo "ğŸ“ˆ [T3] Phase 2B ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ê²°ê³¼ ìš”ì•½"

# Circuit Breaker ë©”íŠ¸ë¦­ ìš”ì•½
echo "ğŸ”„ Circuit Breaker ë©”íŠ¸ë¦­:"
if [ -f circuit-breaker-metrics.csv ]; then
    echo "ì´ ìˆ˜ì§‘ ë ˆì½”ë“œ: $(wc -l < circuit-breaker-metrics.csv)"
    echo "ìµœì‹  ìƒíƒœ: $(tail -n 1 circuit-breaker-metrics.csv | cut -d, -f2)"
    echo "ìµœëŒ€ ì‹¤íŒ¨ ìˆ˜: $(tail -n +2 circuit-breaker-metrics.csv | cut -d, -f3 | sort -nr | head -n 1)"
fi

# P95 ë©”íŠ¸ë¦­ ìš”ì•½
echo "ğŸ“Š P95 ì‘ë‹µì‹œê°„ ë©”íŠ¸ë¦­:"
if [ -f p95-results.json ]; then
    cat p95-results.json | jq '{
        p95_ms: .metrics.p95_response_time_ms,
        avg_ms: .metrics.avg_response_time_ms,
        status: .target.status,
        threshold: .target.p95_threshold
    }'
fi

# T1ê³¼ ì—°ë™ ìƒíƒœ í™•ì¸
echo "ğŸ”— T1 ì—°ë™ ìƒíƒœ:"
curl -s http://localhost:8080/api/circuit-breaker/status | jq '{
    t1_server: "ì—°ê²°ë¨",
    circuit_state: .state.state,
    exponential_backoff: .exponential_backoff.enabled
}' 2>/dev/null || echo "âŒ T1 ì—°ë™ ì‹¤íŒ¨"

echo "âœ… [T3] ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ìš”ì•½ ì™„ë£Œ"
```

---

**ğŸ¯ T3 ì‹¤í–‰ ëª…ë ¹ì–´**: `cd /Users/ted/snap3/services/t2-extract && cat /Users/ted/snap3/.t3-phase2b-commands`

**ğŸ“Š ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: `watch -n 5 'curl -s http://localhost:8080/api/circuit-breaker/status | jq .state'`