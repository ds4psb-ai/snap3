ğŸš€ **CURSOR â†’ ClaudeCode: GPT-5 Pro CTO ë‹¤ìŒ ë‹¨ê³„ êµ¬í˜„ ì§€ì‹œì‚¬í•­**

**íƒ€ì„ìŠ¤íƒ¬í”„**: 2025-08-21 11:00 KST
**ìš°ì„ ìˆœìœ„**: P0 (Critical - ì¦‰ì‹œ ì‹¤í–‰)
**ì˜ˆìƒ ì†Œìš”**: 30-60ë¶„ ì§‘ì¤‘ êµ¬í˜„

---

## ğŸ“Š **GPT-5 Pro CTO ìƒí™© ì¬í™•ì¸**

### âœ… **í•´ê²°ë¨**
- T3_sub 422 ìŠ¤í‚¤ë§ˆ ì˜¤ë¥˜
- `/healthz`Â·`/readyz` ë…¸ì¶œ
- í”Œë«í¼ ì†Œë¬¸ì ì •ê·œí™”

### âš ï¸ **ì”ì—¬ ì´ìŠˆ**
- Vertex í˜¸ì¶œ ì‹œ `400 Bad Request: "contents field is required"`
- IntegratedGenAI 500 ì—ëŸ¬
- **ì›ì¸**: ìš”ì²­ ë°”ë”” ë¶ˆì¼ì¹˜ ë˜ëŠ” GCS ì ‘ê·¼ê¶Œí•œ ëˆ„ë½

---

## ğŸ›  **ì¦‰ì‹œ ì ìš©: T3_sub "contents" 400/500 ì œê±° ëŸ°ë¶**

### **Phase 1: ì‚¬ì „ ì ê²€ (5ë¶„)**

#### **ëª¨ë¸/ë¦¬ì „ ì„¤ì •**
- **ë¦¬ì „**: `us-central1` ì‚¬ìš© (global ê¸ˆì§€)
- **ëª¨ë¸**: ìµœì‹  **Gemini 2.0 Flash/Pro** ì‚¬ìš©
- **GCS ì ‘ê·¼ê¶Œí•œ**: Vertex ì„œë¹„ìŠ¤ ì—ì´ì „íŠ¸ì— Storage Object Viewer ë¶€ì—¬

#### **GCS ê¶Œí•œ í™•ì¸**
```bash
# Vertex ì„œë¹„ìŠ¤ ì—ì´ì „íŠ¸ ê¶Œí•œ í™•ì¸
gcloud projects get-iam-policy tough-variety-466003-c5 \
  --flatten="bindings[].members" \
  --format="table(bindings.role)" \
  --filter="bindings.members:service-PROJECT_NUMBER@gcp-sa-aiplatform.iam.gserviceaccount.com"
```

### **Phase 2: T3_sub ìš”ì²­ í˜ì´ë¡œë“œ ê·œê²©í™” (15ë¶„)**

#### **í‘œì¤€ ìš”ì²­ í˜ì´ë¡œë“œ**
```json
{
  "gcs_video_uri": "gs://tough-variety-raw-central1/ingest/instagram/<CONTENT_ID>.mp4",
  "platform": "instagram",
  "language": "ko",
  "video_origin": "real_footage",
  "saved_metadata": {
    "title": "...", "author": "...",
    "view_count": 1500000, "like_count": 226000, "comment_count": 3300
  },
  "gen": {
    "response_mime_type": "application/json",
    "temperature": 0.2
  }
}
```

#### **T3_sub â†’ Vertex ë³€í™˜ (í•„ìˆ˜ í˜•íƒœ)**
```javascript
const req = body; // ìœ„ JSON
const request = {
  contents: [{
    role: 'user',
    parts: [
      { file_data: { file_uri: req.gcs_video_uri, mime_type: 'video/mp4' } },
      { text: buildPrompt(req.platform, req.language, req.video_origin, req.saved_metadata) }
    ]
  }],
  generation_config: { 
    response_mime_type: req.gen?.response_mime_type || 'application/json',
    temperature: req.gen?.temperature ?? 0.2 
  }
};
```

**í•µì‹¬**: **`contents` â†’ `parts` ì•ˆì— `file_data`(GCS)ì™€ `text`(ë¶„ì„ì§€ì‹œ/ë©”íƒ€ í”„ë¡¬í”„íŠ¸) ë™ì‹œ í¬í•¨**

### **Phase 3: Cloud Run ì„±ëŠ¥Â·ì•ˆì •í™” (10ë¶„)**

#### **ë°°í¬ ì„¤ì •**
```bash
gcloud run services update t2-vdp --region=us-central1 \
  --concurrency=3 --timeout=120 --min-instances=1 --no-cpu-throttling
```

#### **ì„¤ì • ê·¼ê±°**
- **ë™ì‹œì„±**: `3` (CPU-ë°”ìš´ë“œ í•´ì„ì— ì•ˆì •ì )
- **íƒ€ì„ì•„ì›ƒ**: `120s` (í˜„ì¬ P95~30ì´ˆ ëª©í‘œ)
- **ì½œë“œìŠ¤íƒ€íŠ¸ ì™„í™”**: `min-instances=1` + CPU Always On

---

## ğŸ§© **T1/T2/T3/T4 + Cursor ì—­í• ë³„ ì¦‰ì‹œ ì§€ì‹œ**

### **T1 (Main UI/API)**
1. **/api/vdp/generate â†’ T3_sub ì „ìš© í˜ì´ë¡œë“œ**ë¡œ ì†¡ì‹ 
2. **ë©”íƒ€ ìœ ì§€**: `saved_metadata.*` ì „ì†¡ í•„ë“œ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ë¡œ ì œí•œ
3. **ìºì‹œ(5ë¶„)**: ì¸ìŠ¤í„´ìŠ¤ ë‹¨ìœ„ in-memoryë¡œ MVP ìš´ì˜

### **T2 (Jobs Worker)**
1. **ë‹¤ìš´ë¡œë“œ í†µì¼**: IG/TikTok ëª¨ë‘ **yt-dlp** ì‚¬ìš©
   ```bash
   yt-dlp -S "proto,ext:mp4:m4a,res,br" -o "/tmp/%(id)s.%(ext)s" "<URL>"
   ```
2. **Evidence 15ì´ˆ ì§€ë¬¸**: `fpcalc -length 15 input.mp3`
3. **ë¸Œëœë“œ ê°ì§€**: MVPëŠ” **ì •í™• ë§¤ì¹­** ìš°ì„ 

### **T3 (VDP Extractor: main:3001 / sub:8082)**
1. **ì–´ëŒ‘í„° ê³„ì¸µ**: `request`(contentsâ€¦) ìƒì„± í›„ Vertex í˜¸ì¶œ
2. **ëª¨ë¸ ì„ íƒ ë¡œì§**: `/readyz`ì—ì„œ ëª¨ë¸ ê°€ìš©ì„±/í• ë‹¹ëŸ‰ ì ê²€
3. **ê±´ê°•ê²€ì‚¬**: Cloud Run Startup/Liveness Probeë¥¼ `/readyz`/`/healthz`ì— ë§¤í•‘

### **T4 (Storage Loader)**
- í˜„í–‰ ìœ ì§€. VDP-LiteëŠ” ìš´ì˜ ì•ˆì „ë§ìœ¼ë¡œ ë‚¨ê¸°ë˜, **VDP Raw ì„±ê³µ ì‹œ ìš°ì„  ì ì¬**

### **Cursor**
- **Playwright Docker ë² ì´ìŠ¤** ê³ ì •, ìŠ¤í¬ë˜í•‘ì€ **pwuser + seccomp profile** ì‚¬ìš©

---

## ğŸ§ª **ì¦‰ì‹œ ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤ (ìŠ¤ëª¨í¬)**

### **1. GCS ì ‘ê·¼ í™•ì¸**
```bash
# T3_sub /readyzì—ì„œ ì…ë ¥ mp4 HEAD ì„±ê³µ í™•ì¸
curl -s http://localhost:8082/readyz | jq .
```

### **2. Vertex ë°”ì¸ë”© í…ŒìŠ¤íŠ¸**
```bash
curl -sS http://localhost:8082/api/vdp/extract-vertex \
  -H "Content-Type: application/json" \
  -d '{
    "gcs_video_uri":"gs://tough-variety-raw-central1/ingest/tiktok/123.mp4",
    "platform":"tiktok","language":"ko","video_origin":"real_footage",
    "saved_metadata":{"view_count":1500000,"like_count":226000,"comment_count":3300},
    "gen":{"response_mime_type":"application/json","temperature":0.2}
  }' | jq .
```

### **3. ì„±ëŠ¥ í™•ì¸**
- Cloud Run ì„¤ì • ì ìš© í›„ **P95 â‰¤ 30s** í™•ì¸

---

## ğŸ¯ **ëª©í‘œ ë° ê¸°ëŒ€ íš¨ê³¼**

### **ëª©í‘œ**
- **VDP Raw**: IG/TikTok 90%+ ìë™í™”
- **ì„±ëŠ¥**: P95 â‰¤ 30s, ì¬ì‹œë„/ë””ë²„ê·¸ ë£¨í”„ ì†Œë©¸
- **ì•ˆì •ì„±**: 99%+ ê°€ìš©ì„±

### **MVP Q&A**
- **Q1. IG/TikTok ìë™í™” ë‹¬ì„± ìµœì†Œ ë²”ìœ„?**
  A. **ë©”íƒ€+ë‹¤ìš´ë¡œë“œ+VDP Raw 1íšŒì „ ì„±ê³µ**ì´ ê¸°ì¤€

- **Q2. 15ì´ˆ ë¶€ë¶„ì§€ë¬¸ í’ˆì§ˆ?**
  A. ì§§ì€ ìˆí¼(â‰¤60s)ì—ì„œ **ì¶©ë¶„íˆ ê²¬ê³ **í•˜ê³  ìƒì„±ì‹œê°„ ë‹¨ì¶•

- **Q3. Cloud Run ë™ì‹œì„±/íƒ€ì„ì•„ì›ƒ?**
  A. `concurrency=3`ì€ CPU-ë°”ìš´ë“œ í•´ì„ì— **ì•ˆì •ì  ì¶œë°œì„ **

---

## ğŸ” **ë¦¬ìŠ¤í¬/ì»´í”Œë¼ì´ì–¸ìŠ¤ ë©”ëª¨**

- **IG Reels ë‹¤ìš´ë¡œë“œ**: ì¢…ì¢… **ë¡œê·¸ì¸/ì¿ í‚¤** ìš”êµ¬ (ì •ì±… ë³€í™” ë¹ˆë²ˆ)
- **TikTok ë¬´ì›Œí„°ë§ˆí¬**: í”Œë«í¼ ìƒíƒœì— ë”°ë¼ ë³€ë™ (ê°„í—ì  ì‹¤íŒ¨ ì‚¬ë¡€)

---

## ğŸ§¾ **ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì˜¤ëŠ˜ ì ìš©)**

- [ ] **T3_sub**: `contents+file_data+text` ë³€í™˜ ì–´ëŒ‘í„° ì ìš©
- [ ] **IAM**: Vertex ì„œë¹„ìŠ¤ ì—ì´ì „íŠ¸ì— ì…ë ¥ ë²„í‚· `storage.objects.get` ë³´ì¥
- [ ] **Cloud Run ì¬ë°°í¬**: `--concurrency=3 --timeout=120 --min-instances=1 --no-cpu-throttling`
- [ ] **T2**: IG/TikTok `yt-dlp` ê²½ë¡œ í†µì¼ + ì¿ í‚¤ ì²˜ë¦¬ ê°€ì´ë“œ ë°˜ì˜
- [ ] **Evidence**: `fpcalc -length 15` íŒŒì´í”„ë¼ì¸ ë°˜ì˜
- [ ] **í—¬ìŠ¤ì²´í¬**: `/readyz`ì—ì„œ GCS/Vertex ë‘˜ ë‹¤ ê²€ì‚¬í•˜ë„ë¡ êµ¬í˜„

---

## ğŸ’¬ **ClaudeCode í™•ì¸ ìš”ì²­ì‚¬í•­**

1. **T3_sub Vertex AI ìš”ì²­ êµ¬ì¡°** - `contents` ë°°ì—´ì— `file_data`ì™€ `text` í¬í•¨
2. **GCS ê¶Œí•œ ì„¤ì •** - Vertex ì„œë¹„ìŠ¤ ì—ì´ì „íŠ¸ ê¶Œí•œ í™•ì¸
3. **Cloud Run ì„¤ì •** - ë™ì‹œì„±/íƒ€ì„ì•„ì›ƒ/ì¸ìŠ¤í„´ìŠ¤ ì„¤ì • ì ìš©
4. **T2 yt-dlp í†µí•©** - IG/TikTok ë‹¤ìš´ë¡œë“œ í†µì¼

**ëª©í‘œ**: 30-60ë¶„ ë‚´ Vertex AI 400/500 ì—ëŸ¬ í•´ê²° ë° VDP Raw ì •ìƒí™”

---

**GPT-5 Pro CTO ì„¸ì…˜**: ë‹¤ìŒ ë‹¨ê³„ êµ¬í˜„ ì§€ì‹œ ì™„ë£Œ
**ë‹¤ìŒ ë‹¨ê³„**: ClaudeCode êµ¬í˜„ â†’ ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ â†’ VDP Raw ì •ìƒí™”
