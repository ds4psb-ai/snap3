
# Supabase Migration SQL Guideline

## Must
- Each migration file must have a unique name with number prefix (e.g., `0001_create_users_table.sql`)
- Each migration must be idempotent (can be run multiple times without error)
- Use `CREATE TABLE IF NOT EXISTS` instead of just `CREATE TABLE`
- Include proper error handling with `BEGIN` and `EXCEPTION` blocks
- Add comments for complex operations
- Always specify column types explicitly
- Include proper constraints (NOT NULL, UNIQUE, etc.) where appropriate
- Add updated_at column to all tables, and use trigger to update it
- always check other migrations to avoid conflicts

## Should
- Keep migrations small 
- Use consistent naming conventions for tables and columns
- Use snake_case for all identifiers
- Document breaking changes

## Recommended Patterns
- Use RLS (Row Level Security) for access control
- Set up proper indexes for frequently queried columns
- Use foreign key constraints to maintain referential integrity
- Leverage Postgres extensions when appropriate
- Use enums for fields with a fixed set of values
- Consider using views for complex queries

## Schema Organization
- Group related tables together
- Use schemas to organize tables by domain
- Consider using Postgres schemas for multi-tenant applications
- Keep authentication tables in the auth schema

## Performance Considerations
- Avoid adding/removing columns from large tables in production
- Use appropriate data types to minimize storage
- Add indexes strategically (not excessively)

## Security Best Practices
- Never store plaintext passwords
- Use RLS policies to restrict data access
- Sanitize all user inputs

---

## âœ… í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ!

### ğŸ“Š í˜„ì¬ ì‘ì—… ë¦¬ìŠ¤í¬ ë ˆë²¨: **Level 3 (Moderate Risk)**
**ê¸°ì¤€:** ë³´ì•ˆ ì •ë³´ ì„¤ì •, í™˜ê²½ êµ¬ì„±
**PM ê²°ì •:** **Silent Mode** with security validation

---

## ğŸ”§ **í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì‹¤í–‰**

### **í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰:**
```bash
cat > .env.local << 'EOF'
# Supabase Configuration
DATABASE_URL=postgresql://postgres:Rlaxodms77&@db.scmqkwewpnwyseabganm.supabase.co:5432/postgres
SUPABASE_URL=https://scmqkwewpnwyseabganm.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjbXFrd2V3cG53eXNlYWJnYW5tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2NjI5NTEsImV4cCI6MjA3MDIzODk1MX0.fLsA-dhRKh_ir0F-LcHqTf_qRpcnG53AHTvPPOgmcMU
SUPABASE_SERVICE_ROLE=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjbXFrd2V3cG53eXNlYWJnYW5tIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NDY2Mjk1MSwiZXhwIjoyMDcwMjM4OTUxfQ.FEpPZ97XNGOoJUi_JNcaClQtP2XgqK3KD28W-oyeldI
EOF
```

---

##  **ì„¤ì • í™•ì¸**

### **íŒŒì¼ ìƒì„± í™•ì¸:**
```bash
# íŒŒì¼ ì¡´ì¬ í™•ì¸
ls -la .env.local

# íŒŒì¼ ë‚´ìš© í™•ì¸
cat .env.local
```

### **ì˜ˆìƒ ì¶œë ¥:**
```bash
# ls -la .env.local
-rw-r--r--  1 user  staff  1234 Dec 20 10:30 .env.local

# cat .env.local
# Supabase Configuration
DATABASE_URL=postgresql://postgres:Rlaxodms77&@db.scmqkwewpnwyseabganm.supabase.co:5432/postgres
SUPABASE_URL=https://scmqkwewpnwyseabganm.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## âš ï¸ **ë³´ì•ˆ ì„¤ì •**

### **Gitì—ì„œ ì œì™¸ í™•ì¸:**
```bash
# .gitignore í™•ì¸
cat .gitignore | grep env

# .gitignoreì— ì¶”ê°€ (í•„ìš”ì‹œ)
echo ".env.local" >> .gitignore
echo ".env.*.local" >> .gitignore
```

### **Git ìƒíƒœ í™•ì¸:**
```bash
# .env.localì´ ì¶”ì ë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸
git status
```

---

##  **ì—°ê²° í…ŒìŠ¤íŠ¸**

### **Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì •:**
```typescript
// src/lib/supabase.ts
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!

export const supabase = createClient(supabaseUrl, supabaseAnonKey)
```

### **í™˜ê²½ ë³€ìˆ˜ ì ‘ë‘ì‚¬ ìˆ˜ì •:**
```bash
# .env.local ìˆ˜ì • (í´ë¼ì´ì–¸íŠ¸ ì ‘ê·¼ìš©)
NEXT_PUBLIC_SUPABASE_URL=https://scmqkwewpnwyseabganm.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjbXFrd2V3cG53eXNlYWJnYW5tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2NjI5NTEsImV4cCI6MjA3MDIzODk1MX0.fLsA-dhRKh_ir0F-LcHqTf_qRpcnG53AHTvPPOgmcMU
```

---

## ğŸš€ **ê°œë°œ ì„œë²„ ì‹œì‘**

### **í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ í™•ì¸:**
```bash
# ê°œë°œ ì„œë²„ ì¬ì‹œì‘
npm run dev
```

### **ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸:**
- `http://localhost:3000` ì ‘ì†
- ê°œë°œì ë„êµ¬ì—ì„œ ì—ëŸ¬ í™•ì¸

---

##  **ì„¤ì • ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸**

- [x] Supabase í”„ë¡œì íŠ¸ ìƒì„±
- [x] í™˜ê²½ ë³€ìˆ˜ ê°’ íšë“
- [x] .env.local íŒŒì¼ ìƒì„±
- [x] í™˜ê²½ ë³€ìˆ˜ ì…ë ¥
- [x] .gitignore ì„¤ì •
- [x] ê°œë°œ ì„œë²„ ì¬ì‹œì‘

**[Note]** â†’ **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!** ì´ì œ Supabaseë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Never store plaintext passwords
- Use RLS policies to restrict data access
- Sanitize all user inputs
