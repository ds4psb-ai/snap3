# Ïö¥ÏòÅ Ï†êÍ≤Ä Î£®Ìã¥ - t2-extract ÏÑúÎπÑÏä§ (v1.4.0)

**Î™©Ï†Å**: ÌîåÎû´Ìèº 3Ï¢Ö (YouTube/Instagram/TikTok) ÎåÄÎüâ Ï†ÅÏû¨ Ï†Ñ "Ìïú Î≤àÏóê" Ï†ÑÏ≤¥ ÏãúÏä§ÌÖú Í≤ÄÏ¶ù

## üîß ÌôòÍ≤Ω ÏÑ§Ï†ï Í≤ÄÏ¶ù

### 1. Cloud Run ÏÑúÎπÑÏä§ ÏÉÅÌÉú ÌôïÏù∏
```bash
# ÌòÑÏû¨ ÏÑúÎπÑÏä§ ÏÉÅÌÉú Î∞è Î¶¨ÎπÑÏ†Ñ Ï†ïÎ≥¥
gcloud run services describe t2-vdp --region=us-central1 --format="yaml"

# ÌôúÏÑ± Î¶¨ÎπÑÏ†Ñ ÌôïÏù∏
gcloud run revisions list --service=t2-vdp --region=us-central1 --format="table(metadata.name,status.conditions[0].status,spec.template.spec.containers[0].env[*].name)"
```

### 2. ÌïÑÏàò ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï/ÏóÖÎç∞Ïù¥Ìä∏
```bash
# ÌôòÍ≤ΩÎ≥ÄÏàò ÏóÖÎç∞Ïù¥Ìä∏ (ÏÉà Î¶¨ÎπÑÏ†Ñ ÏÉùÏÑ±)
gcloud run services update t2-vdp \
  --region=us-central1 \
  --set-env-vars=PLATFORM_SEGMENTED_PATH=true \
  --set-env-vars=RAW_BUCKET=tough-variety-raw-central1 \
  --set-env-vars=GOLD_BUCKET=tough-variety-gold-central1 \
  --set-env-vars=DATASET=vdp_dataset \
  --set-env-vars=GOLD_TABLE=vdp_gold \
  --set-env-vars=EVIDENCE_MODE=true \
  --set-env-vars=HOOK_MIN_STRENGTH=0.70 \
  --set-env-vars=HOOK_MAX_START_SEC=3.0

# ÌôòÍ≤ΩÎ≥ÄÏàò Í≤ÄÏ¶ù
gcloud run services describe t2-vdp --region=us-central1 --format="value(spec.template.spec.template.spec.containers[0].env[*].name,spec.template.spec.template.spec.containers[0].env[*].value)"
```

### 3. Í∂åÌïú Î∞è Ïù∏Ï¶ù Í≤ÄÏ¶ù
```bash
# ID ÌÜ†ÌÅ∞ Î∞úÍ∏â ÌÖåÏä§Ìä∏
echo "üîë ID Token Generation Test:"
TOKEN=$(gcloud auth print-identity-token)
echo "Token Length: ${#TOKEN}"
echo "Token Preview: ${TOKEN:0:50}..."

# ÏÑúÎπÑÏä§ Í≥ÑÏ†ï ÌôïÏù∏
echo "üìã Service Account Info:"
gcloud iam service-accounts list --filter="email:*t2-vdp*" --format="table(email,displayName,disabled)"

# Î≤ÑÌÇ∑ Ï†ëÍ∑º Í∂åÌïú ÌôïÏù∏
echo "üóÑÔ∏è Bucket Access Verification:"
gsutil ls gs://tough-variety-raw-central1/raw/vdp/ 2>/dev/null && echo "‚úÖ RAW bucket accessible" || echo "‚ùå RAW bucket access failed"
gsutil ls gs://tough-variety-gold-central1/dt=* 2>/dev/null && echo "‚úÖ GOLD bucket accessible" || echo "‚ùå GOLD bucket access failed"
```

## üß™ ÏÑúÎπÑÏä§ Í∏∞Îä• Í≤ÄÏ¶ù

### 4. t2-extract API ÏóîÎìúÌè¨Ïù∏Ìä∏ ÌÖåÏä§Ìä∏
```bash
# ÏÑúÎπÑÏä§ URL ÌôïÏù∏
SERVICE_URL=$(gcloud run services describe t2-vdp --region=us-central1 --format="value(status.url)")
echo "Service URL: $SERVICE_URL"

# Health Check
echo "üè• Health Check:"
curl -H "Authorization: Bearer $TOKEN" \
  "$SERVICE_URL/health" \
  -w "\nStatus: %{http_code}\nTime: %{time_total}s\n"

# Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ ÏóîÎìúÌè¨Ïù∏Ìä∏ ÌÖåÏä§Ìä∏
echo "üìä Metadata Endpoint Test:"
curl -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  "$SERVICE_URL/api/metadata" \
  -d '{"platform":"youtube","content_id":"test"}' \
  -w "\nStatus: %{http_code}\n"
```

### 5. ÌîåÎû´ÌèºÎ≥Ñ VDP ÏÉùÏÑ± ÌÖåÏä§Ìä∏

#### YouTube ÌÖåÏä§Ìä∏
```bash
echo "üé• YouTube VDP Generation Test:"
cat > test_youtube_request.json << EOF
{
  "gcsUri": "gs://tough-variety-raw-central1/test/sample-youtube.mp4",
  "meta": {
    "platform": "YouTube",
    "language": "ko",
    "content_id": "TEST_YT_$(date +%s)",
    "source_url": "https://youtube.com/shorts/test"
  }
}
EOF

curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  "$SERVICE_URL/api/vdp/generate" \
  -d @test_youtube_request.json \
  -w "\nYouTube Test - Status: %{http_code}, Time: %{time_total}s\n"
```

#### Instagram ÌÖåÏä§Ìä∏
```bash
echo "üì∑ Instagram VDP Generation Test:"
cat > test_instagram_request.json << EOF
{
  "gcsUri": "gs://tough-variety-raw-central1/test/sample-instagram.mp4",
  "meta": {
    "platform": "Instagram",
    "language": "ko",
    "content_id": "TEST_IG_$(date +%s)",
    "source_url": "https://instagram.com/reel/test"
  }
}
EOF

curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  "$SERVICE_URL/api/vdp/generate" \
  -d @test_instagram_request.json \
  -w "\nInstagram Test - Status: %{http_code}, Time: %{time_total}s\n"
```

#### TikTok ÌÖåÏä§Ìä∏
```bash
echo "üéµ TikTok VDP Generation Test:"
cat > test_tiktok_request.json << EOF
{
  "gcsUri": "gs://tough-variety-raw-central1/test/sample-tiktok.mp4",
  "meta": {
    "platform": "TikTok",
    "language": "ko",
    "content_id": "TEST_TT_$(date +%s)",
    "source_url": "https://tiktok.com/video/test"
  }
}
EOF

curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  "$SERVICE_URL/api/vdp/generate" \
  -d @test_tiktok_request.json \
  -w "\nTikTok Test - Status: %{http_code}, Time: %{time_total}s\n"
```

## üìã Îç∞Ïù¥ÌÑ∞ Í≤ÄÏ¶ù

### 6. BigQuery Ïó∞Í≤∞ Î∞è Ïä§ÌÇ§Îßà Í≤ÄÏ¶ù
```bash
echo "üóÉÔ∏è BigQuery Integration Test:"

# ÌÖåÏù¥Î∏î Ï°¥Ïû¨ ÌôïÏù∏
bq show tough-variety-466003-c5:vdp_dataset.vdp_gold && echo "‚úÖ vdp_gold table exists" || echo "‚ùå vdp_gold table missing"

# ÏµúÍ∑º Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
bq query --use_legacy_sql=false "
SELECT 
  load_date,
  COUNT(*) as record_count,
  COUNT(DISTINCT JSON_VALUE(metadata, '$.platform')) as platform_count,
  MIN(load_timestamp) as earliest_load,
  MAX(load_timestamp) as latest_load
FROM \`tough-variety-466003-c5.vdp_dataset.vdp_gold\`
WHERE load_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)
GROUP BY load_date
ORDER BY load_date DESC
LIMIT 5"
```

### 7. Hook Genome Í≤ÄÏ¶ù
```bash
echo "üß¨ Hook Genome Validation:"

# Hook Genome ÌïÑÎìú Ï°¥Ïû¨ ÌôïÏù∏
bq query --use_legacy_sql=false "
SELECT 
  COUNT(*) as total_records,
  COUNT(JSON_VALUE(overall_analysis, '$.hookGenome.pattern_code')) as hook_pattern_count,
  COUNT(JSON_VALUE(overall_analysis, '$.hookGenome.strength_score')) as strength_score_count,
  AVG(CAST(JSON_VALUE(overall_analysis, '$.hookGenome.strength_score') AS FLOAT64)) as avg_strength,
  COUNT(CASE WHEN CAST(JSON_VALUE(overall_analysis, '$.hookGenome.start_sec') AS FLOAT64) <= 3.0 THEN 1 END) as valid_hook_timing
FROM \`tough-variety-466003-c5.vdp_dataset.vdp_gold\`
WHERE load_date = CURRENT_DATE()
AND JSON_VALUE(overall_analysis, '$.hookGenome') IS NOT NULL"
```

### 8. Evidence Pack Í≤ÄÏ¶ù
```bash
echo "üîç Evidence Pack Validation:"

# Evidence Pack ÌïÑÎìú Ï°¥Ïû¨ ÌôïÏù∏
bq query --use_legacy_sql=false "
SELECT 
  COUNT(*) as total_records,
  COUNT(JSON_VALUE(evidence_pack, '$.audio_fingerprint.provider')) as audio_fingerprint_count,
  COUNT(JSON_VALUE(evidence_pack, '$.product_evidence.product_mentions')) as product_evidence_count,
  COUNT(CASE WHEN JSON_VALUE(evidence_pack, '$.audio_fingerprint.provider') = 'chromaprint' THEN 1 END) as chromaprint_count
FROM \`tough-variety-466003-c5.vdp_dataset.vdp_gold\`
WHERE load_date = CURRENT_DATE()
AND evidence_pack IS NOT NULL"
```

## üö¶ ÌíàÏßà Í≤åÏù¥Ìä∏ Í≤ÄÏ¶ù

### 9. VDP ÌíàÏßà ÌôïÏù∏
```bash
echo "‚ö° VDP Quality Gates:"

# ÌïÑÏàò ÌïÑÎìú ÏôÑÏÑ±ÎèÑ ÌôïÏù∏
bq query --use_legacy_sql=false "
SELECT 
  'Field Completeness Check' as check_type,
  COUNT(*) as total_records,
  COUNT(content_key) as content_key_count,
  COUNT(content_id) as content_id_count,
  COUNT(JSON_VALUE(metadata, '$.platform')) as platform_count,
  COUNT(JSON_VALUE(metadata, '$.language')) as language_count,
  COUNT(load_timestamp) as load_timestamp_count,
  COUNT(load_date) as load_date_count,
  ROUND(COUNT(content_key) * 100.0 / COUNT(*), 2) as completeness_percentage
FROM \`tough-variety-466003-c5.vdp_dataset.vdp_gold\`
WHERE load_date = CURRENT_DATE()"

# Hook Gate ÌÜµÍ≥ºÏú® ÌôïÏù∏
bq query --use_legacy_sql=false "
SELECT 
  'Hook Gate Validation' as check_type,
  COUNT(*) as total_records,
  COUNT(CASE WHEN CAST(JSON_VALUE(overall_analysis, '$.hookGenome.start_sec') AS FLOAT64) <= 3.0 
             AND CAST(JSON_VALUE(overall_analysis, '$.hookGenome.strength_score') AS FLOAT64) >= 0.70 
        THEN 1 END) as hook_gate_passed,
  ROUND(COUNT(CASE WHEN CAST(JSON_VALUE(overall_analysis, '$.hookGenome.start_sec') AS FLOAT64) <= 3.0 
                    AND CAST(JSON_VALUE(overall_analysis, '$.hookGenome.strength_score') AS FLOAT64) >= 0.70 
               THEN 1 END) * 100.0 / COUNT(*), 2) as hook_gate_pass_rate
FROM \`tough-variety-466003-c5.vdp_dataset.vdp_gold\`
WHERE load_date = CURRENT_DATE()
AND JSON_VALUE(overall_analysis, '$.hookGenome') IS NOT NULL"
```

### 10. ÌîåÎû´ÌèºÎ≥Ñ Ï≤òÎ¶¨ ÌòÑÌô© ÌôïÏù∏
```bash
echo "üìä Platform Processing Status:"

bq query --use_legacy_sql=false "
SELECT 
  JSON_VALUE(metadata, '$.platform') as platform,
  COUNT(*) as record_count,
  COUNT(DISTINCT content_key) as unique_content,
  MIN(load_timestamp) as first_processed,
  MAX(load_timestamp) as last_processed,
  COUNT(CASE WHEN JSON_VALUE(overall_analysis, '$.hookGenome') IS NOT NULL THEN 1 END) as hook_genome_count,
  COUNT(CASE WHEN evidence_pack IS NOT NULL THEN 1 END) as evidence_pack_count
FROM \`tough-variety-466003-c5.vdp_dataset.vdp_gold\`
WHERE load_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY)
GROUP BY platform
ORDER BY platform"
```

## ‚úÖ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ ÏôÑÎ£å ÌôïÏù∏

### ÏµúÏ¢Ö Í≤ÄÏ¶ù Ïä§ÌÅ¨Î¶ΩÌä∏
```bash
#!/bin/bash
echo "üéØ Final Operational Readiness Check:"

# Í∞Å Ï≤¥ÌÅ¨Ìï≠Î™©Î≥Ñ Ï†êÏàò Í≥ÑÏÇ∞
SCORE=0
TOTAL_CHECKS=10

echo "1. Cloud Run Service Status..." 
gcloud run services describe t2-vdp --region=us-central1 > /dev/null 2>&1 && { echo "  ‚úÖ Pass"; ((SCORE++)); } || echo "  ‚ùå Fail"

echo "2. Environment Variables..."
ENV_COUNT=$(gcloud run services describe t2-vdp --region=us-central1 --format="value(spec.template.spec.template.spec.containers[0].env[*].name)" | wc -w)
[[ $ENV_COUNT -ge 6 ]] && { echo "  ‚úÖ Pass ($ENV_COUNT vars)"; ((SCORE++)); } || echo "  ‚ùå Fail ($ENV_COUNT vars)"

echo "3. ID Token Generation..."
TOKEN=$(gcloud auth print-identity-token 2>/dev/null)
[[ -n "$TOKEN" ]] && { echo "  ‚úÖ Pass"; ((SCORE++)); } || echo "  ‚ùå Fail"

echo "4. Service Health Check..."
SERVICE_URL=$(gcloud run services describe t2-vdp --region=us-central1 --format="value(status.url)")
curl -s -H "Authorization: Bearer $TOKEN" "$SERVICE_URL/health" > /dev/null && { echo "  ‚úÖ Pass"; ((SCORE++)); } || echo "  ‚ùå Fail"

echo "5. RAW Bucket Access..."
gsutil ls gs://tough-variety-raw-central1/raw/vdp/ > /dev/null 2>&1 && { echo "  ‚úÖ Pass"; ((SCORE++)); } || echo "  ‚ùå Fail"

echo "6. GOLD Bucket Access..."
gsutil ls gs://tough-variety-gold-central1/ > /dev/null 2>&1 && { echo "  ‚úÖ Pass"; ((SCORE++)); } || echo "  ‚ùå Fail"

echo "7. BigQuery Table Access..."
bq show tough-variety-466003-c5:vdp_dataset.vdp_gold > /dev/null 2>&1 && { echo "  ‚úÖ Pass"; ((SCORE++)); } || echo "  ‚ùå Fail"

echo "8. Recent VDP Data..."
RECENT_COUNT=$(bq query --use_legacy_sql=false --format=csv "SELECT COUNT(*) FROM \`tough-variety-466003-c5.vdp_dataset.vdp_gold\` WHERE load_date = CURRENT_DATE()" 2>/dev/null | tail -n1)
[[ $RECENT_COUNT -gt 0 ]] && { echo "  ‚úÖ Pass ($RECENT_COUNT records)"; ((SCORE++)); } || echo "  ‚ùå Fail ($RECENT_COUNT records)"

echo "9. Hook Genome Integration..."
HOOK_COUNT=$(bq query --use_legacy_sql=false --format=csv "SELECT COUNT(*) FROM \`tough-variety-466003-c5.vdp_dataset.vdp_gold\` WHERE JSON_VALUE(overall_analysis, '$.hookGenome.pattern_code') IS NOT NULL AND load_date = CURRENT_DATE()" 2>/dev/null | tail -n1)
[[ $HOOK_COUNT -gt 0 ]] && { echo "  ‚úÖ Pass ($HOOK_COUNT records)"; ((SCORE++)); } || echo "  ‚ùå Fail ($HOOK_COUNT records)"

echo "10. Evidence Pack Integration..."
EVIDENCE_COUNT=$(bq query --use_legacy_sql=false --format=csv "SELECT COUNT(*) FROM \`tough-variety-466003-c5.vdp_dataset.vdp_gold\` WHERE evidence_pack IS NOT NULL AND load_date = CURRENT_DATE()" 2>/dev/null | tail -n1)
[[ $EVIDENCE_COUNT -gt 0 ]] && { echo "  ‚úÖ Pass ($EVIDENCE_COUNT records)"; ((SCORE++)); } || echo "  ‚ùå Fail ($EVIDENCE_COUNT records)"

echo ""
echo "üéØ Overall Score: $SCORE/$TOTAL_CHECKS ($(echo "scale=1; $SCORE*100/$TOTAL_CHECKS" | bc)%)"

if [[ $SCORE -ge 8 ]]; then
    echo "‚úÖ SYSTEM READY FOR PRODUCTION LOAD"
    echo "   Ready for multi-platform batch processing"
    exit 0
elif [[ $SCORE -ge 6 ]]; then
    echo "‚ö†Ô∏è  SYSTEM PARTIALLY READY"
    echo "   Review failing checks before production load"
    exit 1
else
    echo "‚ùå SYSTEM NOT READY"
    echo "   Critical issues must be resolved"
    exit 2
fi
```

## üìù Ïã§Ìñâ Í∞ÄÏù¥Îìú

1. **Ïä§ÌÅ¨Î¶ΩÌä∏ Ï†ÄÏû•**: ÏúÑ ÎÇ¥Ïö©ÏùÑ `operational-check.sh`Î°ú Ï†ÄÏû•
2. **Í∂åÌïú ÏÑ§Ï†ï**: `chmod +x operational-check.sh`
3. **Ïã§Ìñâ**: `./operational-check.sh`
4. **Í≤∞Í≥º ÌôïÏù∏**: 8/10 Ïù¥ÏÉÅ ÌÜµÍ≥º Ïãú Ïö¥ÏòÅ Ï§ÄÎπÑ ÏôÑÎ£å

## üîÑ Ï†ïÍ∏∞ Ï†êÍ≤Ä Ï£ºÍ∏∞

- **ÏùºÏùº**: Health Check, ÏµúÍ∑º Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
- **Ï£ºÍ∞Ñ**: Ï†ÑÏ≤¥ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ïã§Ìñâ
- **ÎåÄÎüâ Ï≤òÎ¶¨ Ï†Ñ**: Î∞òÎìúÏãú Ï†ÑÏ≤¥ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ïã§Ìñâ
- **Î∞∞Ìè¨ ÌõÑ**: Ï¶âÏãú Ï†ÑÏ≤¥ Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ Ïã§Ìñâ

## üìû Î¨∏Ï†ú Î∞úÏÉù Ïãú ÎåÄÏùë

1. **Ï†êÏàò 6-7**: Í≤ΩÍ≥† ÏàòÏ§Ä, ÎπÑÌïµÏã¨ Í∏∞Îä• Î¨∏Ï†ú Í∞ÄÎä•ÏÑ±
2. **Ï†êÏàò 5 Ïù¥Ìïò**: Ïö¥ÏòÅ Ï§ëÎã®, Ï¶âÏãú Ï°∞Ïπò ÌïÑÏöî
3. **Í∏¥Í∏â Ïó∞ÎùΩ**: Ïù∏ÌîÑÎùºÌåÄ ÎòêÎäî DevOps ÌåÄ Ìò∏Ï∂ú

---
**Last Updated**: 2025-08-19  
**Version**: 1.4.0  
**Compatible with**: t2-extract v1.4.0, VDP Pipeline v1.4.0