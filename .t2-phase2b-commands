# ðŸ“Š T2 Terminal (Jobs/8081) - Phase 2B ìƒì„¸ ëª…ë ¹ì–´

**ì˜ì¡´ì„±**: T1 ì™„ë£Œ ì‹ í˜¸ `.t1-phase2a-done` í™•ì¸ í•„ìˆ˜  
**ì‹¤í–‰ ë°©ì‹**: âš¡ ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥ (T3ì™€ ë™ì‹œ)  
**ìž‘ì—… ì‹œê°„**: 15ë¶„ ì˜ˆìƒ

---

## ðŸ” **ì‚¬ì „ ì¤€ë¹„ (í•„ìˆ˜)**

### **Step 1: T1 ì™„ë£Œ ì‹ í˜¸ í™•ì¸**
```bash
cd /Users/ted/snap3

# T1 ì™„ë£Œ ì‹ í˜¸ ëŒ€ê¸°
while [ ! -f .t1-phase2a-done ]; do
  echo "â³ T1 Circuit Breaker ì™„ë£Œ ëŒ€ê¸° ì¤‘..."
  sleep 3
done

echo "âœ… T1 ì¤€ë¹„ ì™„ë£Œ - T2 Circuit Breaker í…ŒìŠ¤íŠ¸ ì‹œìž‘"
```

### **Step 2: T2 ë””ë ‰í† ë¦¬ í™•ì¸**
```bash
cd /Users/ted/snap3-jobs

# ë””ë ‰í† ë¦¬ í™•ì¸
pwd  # /Users/ted/snap3-jobs í™•ì¸ í•„ìˆ˜

# T2 í¬íŠ¸ í™•ì¸ (8081 ì‚¬ìš© ì¤‘ì´ì–´ì•¼ í•¨)
lsof -i :8081 && echo "âœ… T2 ì„œë²„ ì‹¤í–‰ ì¤‘" || echo "âŒ T2 ì„œë²„ ì—†ìŒ - ì‹œìž‘ í•„ìš”"
```

---

## ðŸ“Š **Circuit Breaker ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (ë©”ì¸ ìž‘ì—…)**

### **Step 3: Circuit Breaker ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸**
```bash
cd /Users/ted/snap3-jobs

# Circuit Breaker ìƒíƒœ í™•ì¸
echo "ðŸ” [T2] Circuit Breaker ì´ˆê¸° ìƒíƒœ í™•ì¸"
curl -s http://localhost:8080/api/circuit-breaker/status | jq '{
  state: .state.state,
  failureCount: .state.failureCount,
  retryAttempts: .state.retryAttempts,
  backoffEnabled: .exponential_backoff.enabled
}'

echo "âœ… [T2] Circuit Breaker ìƒíƒœ í™•ì¸ ì™„ë£Œ"
```

### **Step 4: ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ (30íšŒ)**
```bash
cd /Users/ted/snap3-jobs

echo "âš¡ [T2] Circuit Breaker ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹œìž‘ (30íšŒ)"

# ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
cat > circuit-breaker-failure-test.sh << 'EOF'
#!/bin/bash

echo "ðŸ“Š Circuit Breaker ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸ ì‹œìž‘"
echo "ðŸŽ¯ ëª©í‘œ: 30íšŒ ì‹¤íŒ¨ â†’ OPEN ìƒíƒœ íŠ¸ë¦¬ê±°"

TOTAL_TESTS=30
FAILURE_COUNT=0
SUCCESS_COUNT=0

for i in $(seq 1 $TOTAL_TESTS); do
    echo "ðŸ”„ Test $i/$TOTAL_TESTS"
    
    # ì˜ë„ì  ì‹¤íŒ¨ API í˜¸ì¶œ (ìž˜ëª»ëœ ë°ì´í„°)
    RESPONSE=$(curl -s -w "%{http_code}" -X POST \
        http://localhost:8080/api/vdp/extract-vertex \
        -H "Content-Type: application/json" \
        -H "x-correlation-id: TEST-FAILURE-$i" \
        -d '{
            "gcsUri": "gs://invalid-bucket/invalid-file.mp4",
            "meta": {"platform": "invalid", "language": "invalid"}
        }' 2>/dev/null)
    
    HTTP_CODE="${RESPONSE: -3}"
    
    if [ "$HTTP_CODE" -eq 500 ] || [ "$HTTP_CODE" -eq 400 ]; then
        FAILURE_COUNT=$((FAILURE_COUNT + 1))
        echo "âŒ Test $i: FAILED (HTTP $HTTP_CODE)"
    else
        SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
        echo "âœ… Test $i: PASSED (HTTP $HTTP_CODE)"
    fi
    
    # Circuit Breaker ìƒíƒœ ì¤‘ê°„ ì²´í¬ (5íšŒë§ˆë‹¤)
    if [ $((i % 5)) -eq 0 ]; then
        echo "ðŸ“Š ì¤‘ê°„ ì²´í¬ ($i/$TOTAL_TESTS):"
        curl -s http://localhost:8080/api/circuit-breaker/status | jq '{
            state: .state.state,
            failures: .state.failureCount,
            retries: .state.retryAttempts
        }'
        echo "---"
    fi
    
    # ìš”ì²­ ê°„ê²© (100ms)
    sleep 0.1
done

echo "ðŸ“Š ìµœì¢… í…ŒìŠ¤íŠ¸ ê²°ê³¼:"
echo "ì´ í…ŒìŠ¤íŠ¸: $TOTAL_TESTS"
echo "ì‹¤íŒ¨: $FAILURE_COUNT"
echo "ì„±ê³µ: $SUCCESS_COUNT"
echo "ì‹¤íŒ¨ìœ¨: $((FAILURE_COUNT * 100 / TOTAL_TESTS))%"

# ìµœì¢… Circuit Breaker ìƒíƒœ
echo "ðŸ” ìµœì¢… Circuit Breaker ìƒíƒœ:"
curl -s http://localhost:8080/api/circuit-breaker/status | jq '.'

EOF

chmod +x circuit-breaker-failure-test.sh
```

### **Step 5: ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸ ì‹¤í–‰**
```bash
cd /Users/ted/snap3-jobs

# ë°±ê·¸ë¼ìš´ë“œë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
echo "ðŸš€ [T2] Circuit Breaker ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸ ì‹œìž‘ (ë°±ê·¸ë¼ìš´ë“œ)"
./circuit-breaker-failure-test.sh > circuit-breaker-test-results.log 2>&1 &

# í…ŒìŠ¤íŠ¸ PID ì €ìž¥
TEST_PID=$!
echo "ðŸ“Š í…ŒìŠ¤íŠ¸ PID: $TEST_PID" > .t2-test-pid

echo "âœ… [T2] Circuit Breaker í…ŒìŠ¤íŠ¸ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ì‹œìž‘"
```

---

## ðŸ“ˆ **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**

### **Step 6: í…ŒìŠ¤íŠ¸ ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§**
```bash
cd /Users/ted/snap3-jobs

# ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ (ë³„ë„ ì°½ì—ì„œ)
echo "ðŸ“Š [T2] ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§"
tail -f circuit-breaker-test-results.log | grep -E "(Test [0-9]+|Circuit Breaker|ìµœì¢…|OPEN|CLOSED)"

# ë˜ëŠ” ìš”ì•½ ìƒíƒœë§Œ ë³´ê¸°
watch -n 2 'curl -s http://localhost:8080/api/circuit-breaker/status | jq "{state: .state.state, failures: .state.failureCount, retries: .state.retryAttempts}"'
```

### **Step 7: ì™„ë£Œ ì‹ í˜¸ ìƒì„±**
```bash
cd /Users/ted/snap3-jobs

# í…ŒìŠ¤íŠ¸ ì™„ë£Œ ëŒ€ê¸° (ë°±ê·¸ë¼ìš´ë“œ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œê¹Œì§€)
while kill -0 $(cat .t2-test-pid) 2>/dev/null; do
    echo "â³ [T2] Circuit Breaker í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘..."
    sleep 5
done

# í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
echo "ðŸ“Š [T2] Circuit Breaker í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ê²°ê³¼ ìš”ì•½:"
tail -n 10 circuit-breaker-test-results.log

# T2 ì™„ë£Œ ì‹ í˜¸
echo "âœ… T2 Circuit Breaker ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ" > /Users/ted/snap3/.t2-phase2b-done
echo "âœ… [T2] Phase 2B ì™„ë£Œ - T3ì™€ ë³‘ë ¬ ì§„í–‰ ì™„ë£Œ"
```

---

**ðŸŽ¯ T2 ì‹¤í–‰ ëª…ë ¹ì–´**: `cd /Users/ted/snap3-jobs && cat /Users/ted/snap3/.t2-phase2b-commands`