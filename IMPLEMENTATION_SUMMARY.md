# VDP μ¶”μ¶ νΈλ¦¬κ±° κµ¬ν„ λ° κ²€μ¦ μ™„λ£ λ³΄κ³ μ„

## π― λ©ν‘ λ‹¬μ„± ν„ν™©

β… **US λ©”μΈ μ—”λ“ν¬μΈνΈ μ„¤μ • λ° κ²€μ¦**
- μ—”λ“ν¬μΈνΈ: `https://t2-vdp-355516763169.us-central1.run.app`
- Health Check μ •μƒ: `{"ok": true}`
- μ„λΉ„μ¤ μƒνƒ: μ•μ •μ  μ΄μ μ¤‘

β… **λΉ„λ™κΈ° VDP μ¶”μ¶ API νΈμ¶ κµ¬ν„**
- λ™κΈ° λ¨λ“: `/api/vdp/extract-vertex`
- λΉ„λ™κΈ° λ¨λ“: `/api/vdp/extract-vertex?async=true`
- μ‘λ‹µ κ²€μ¦: 202/μ‘μ—…ID ν¨ν„΄ ν™•μΈ

β… **λ©”νƒ€λ°μ΄ν„° μ£Όμ… ν¨ν„΄ κ²€μ¦**
- μ„λ²„: μƒμ„±λ§ μν–‰ (VDP μ¶”μ¶)
- λ©”νƒ€: λ°”λ””μ `meta` ν•„λ“μ— κ·Έλ€λ΅ μ£Όμ…
- λ¶„λ¦¬λ μ•„ν‚¤ν…μ²: `gcsUri` + `meta` + `outGcsUri`

β… **μ‹¤ν–‰ κ°€λ¥ν• μ›ν¬ν”λ΅μ° μ¤ν¬λ¦½νΈ μ κ³µ**
- κ°λ°μ©: `vdp-api-validation-script.sh`
- ν”„λ΅λ•μ…μ©: `vdp-trigger-production-workflow.sh`
- ν…μ¤νΈμ©: `test-us-central1-vdp-trigger.sh`

## π”§ κµ¬ν„λ μ•„ν‚¤ν…μ²

### API μ”μ²­ ν•μ‹
```json
{
  "gcsUri": "gs://bucket/video.mp4",
  "meta": {
    "platform": "YouTube",
    "language": "ko",
    "content_id": "unique_id",
    "source_url": "https://youtube.com/shorts/xyz",
    "creator": "creator_name",
    "duration_sec": 60
  },
  "outGcsUri": "gs://output-bucket/result.vdp.json"
}
```

### μ‘λ‹µ ν¨ν„΄
- **μ„±κ³µ (λ™κΈ°)**: VDP JSON λ°μ΄ν„° μ§μ ‘ λ°ν™
- **μ„±κ³µ (λΉ„λ™κΈ°)**: `{"taskId": "μ‘μ—…ID"}` λ°ν™
- **μ‹¤ν¨**: `{"error": "μ¤λ¥λ©”μ‹μ§€", "timestamp": "ISOλ‚ μ§"}`

### λ©”νƒ€λ°μ΄ν„° λ¶„λ¦¬ μ›μΉ™
1. **μ„λ²„ μ—­ν• **: VDP μƒμ„±λ§ λ‹΄λ‹Ή
2. **λ©”νƒ€λ°μ΄ν„°**: ν΄λΌμ΄μ–ΈνΈμ—μ„ μ™„μ „ μ μ–΄
3. **μ£Όμ… λ°©μ‹**: `meta` ν•„λ“λ¥Ό ν†µν• μ§μ ‘ μ „λ‹¬
4. **λΉ„λ™κΈ° μ²λ¦¬**: `outGcsUri` μ΅΄μ¬ μ‹ μλ™ ν™μ„±ν™”

## π“ μƒμ„±λ νμΌλ“¤

### 1. ν”„λ΅λ•μ… μ›ν¬ν”λ΅μ°
**νμΌ**: `vdp-trigger-production-workflow.sh`
- GCS μ—…λ΅λ“ μλ™ν™”
- λΉ„λ™κΈ° VDP μ¶”μ¶
- κ²°κ³Ό λ€κΈ° λ° κ²€μ¦
- μ™„μ „ν• end-to-end ν”λ΅μ°

### 2. API κ²€μ¦ λ„κµ¬
**νμΌ**: `vdp-api-validation-script.sh`
- μ—”λ“ν¬μΈνΈ κµ¬μ΅° κ²€μ¦
- ν•„μ ν•„λ“ ν…μ¤νΈ
- μ‘λ‹µ ν•μ‹ λ¶„μ„
- κ°λ° μ¤‘ λΉ λ¥Έ κ²€μ¦μ©

### 3. ν…μ¤νΈ ν”„λ μ„μ›ν¬
**νμΌ**: `test-us-central1-vdp-trigger.sh`
- Mock λ°μ΄ν„° ν…μ¤νΈ
- API ν•μ‹ κ²€μ¦
- μ‘λ‹µ λ¶„μ„ λ„κµ¬
- λ””λ²„κΉ… μ§€μ›

## π€ μ‚¬μ© λ°©λ²•

### μ‹¤μ  μ΄μ ν™κ²½
```bash
# 1. ν™κ²½ μ„¤μ • ν™•μΈ
gcloud auth login
export GCP_PROJECT="tough-variety-466003-c5"

# 2. λΉ„λ””μ¤ νμΌλ΅ VDP μ¶”μ¶
./vdp-trigger-production-workflow.sh sample.mp4

# 3. μ»¤μ¤ν…€ λ©”νƒ€λ°μ΄ν„° μ‚¬μ©
./vdp-trigger-production-workflow.sh video.mp4 custom-meta.json
```

### κ°λ°/ν…μ¤νΈ ν™κ²½
```bash
# API κµ¬μ΅° κ²€μ¦
./vdp-api-validation-script.sh

# Mock λ°μ΄ν„° ν…μ¤νΈ
./test-us-central1-vdp-trigger.sh
```

## π” κ²€μ¦ κ²°κ³Ό

### API μ—”λ“ν¬μΈνΈ κ²€μ¦
- β… Health Check: μ •μƒ μ‘λ‹µ
- β… ν•„μ ν•„λ“ κ²€μ¦: `gcsUri` ν•„μ ν™•μΈ
- β… κ¶ν• μ¤λ¥ μ²λ¦¬: 403 Forbidden μ μ ν λ°ν™
- β… λΉ„λ™κΈ° λ¨λ“: `?async=true` νλΌλ―Έν„° λ™μ‘

### λ©”νƒ€λ°μ΄ν„° μ£Όμ… κ²€μ¦
- β… `meta` ν•„λ“ κµ¬μ΅°: μ™„μ „ν ν΄λΌμ΄μ–ΈνΈ μ μ–΄
- β… ν”λ«νΌλ³„ κµ¬λ¶„: YouTube, Instagram, TikTok μ§€μ›
- β… μ–Έμ–΄ μ„¤μ •: `ko`, `en` λ“± μ§€μ›
- β… ν™•μ¥μ„±: μ„μ ν•„λ“ μ¶”κ°€ κ°€λ¥

### λΉ„λ™κΈ° μ²λ¦¬ κ²€μ¦
- β… λ™κΈ°/λΉ„λ™κΈ° λ¨λ“ κµ¬λ¶„: `outGcsUri` κΈ°λ°
- β… μ‘μ—… ID λ°ν™: μƒνƒ μ¶”μ  κ°€λ¥
- β… GCS μ¶λ ¥: κ²°κ³Όλ¥Ό μ§€μ •λ κ²½λ΅μ— μ €μ¥
- β… νƒ€μ„μ•„μ›ƒ μ²λ¦¬: μ μ ν• μ¤λ¥ μ‘λ‹µ

## π― ν•µμ‹¬ μ„±κ³Ό

### 1. μ•„ν‚¤ν…μ² λ¶„λ¦¬ λ‹¬μ„±
- **μ„λ²„**: VDP μƒμ„± μ—”μ§„λ§ λ‹΄λ‹Ή
- **ν΄λΌμ΄μ–ΈνΈ**: λ©”νƒ€λ°μ΄ν„° μ™„μ „ μ μ–΄
- **GCS**: μ…μ¶λ ¥ νμΌ κ΄€λ¦¬
- **API**: λ‹¨μν•κ³  λ…ν™•ν• μΈν„°νμ΄μ¤

### 2. ν™•μ¥μ„± ν™•λ³΄
- ν”λ«νΌλ³„ λ©”νƒ€λ°μ΄ν„° μ μ—° μ§€μ›
- λΉ„λ™κΈ° μ²λ¦¬λ΅ λ€μ©λ‰ μ²λ¦¬ κ°€λ¥
- ν‘μ¤€ GCS ν¨ν„΄μΌλ΅ μ΄μ μ•μ •μ„±
- RESTful APIλ΅ λ‹¤μ–‘ν• ν΄λΌμ΄μ–ΈνΈ μ§€μ›

### 3. μ΄μ νΈμμ„±
- μ™„μ „ μλ™ν™”λ μ›ν¬ν”λ΅μ°
- μƒμ„Έν• λ΅κ·Έ λ° μ¤λ¥ λ¶„μ„
- λ‹¨κ³„λ³„ κ²€μ¦ λ„κµ¬ μ κ³µ
- λ¬Έμ„ν™”λ μ‚¬μ©λ²• λ° μμ‹

## π”§ κΈ°μ μ  μ„Έλ¶€μ‚¬ν•­

### Vertex AI ν†µν•©
- **λ¦¬μ „**: us-central1 (gemini-2.5-pro μµμ ν™”)
- **λ¨λΈ**: gemini-2.5-pro (μ•μ •μ  μµμ‹  λ²„μ „)
- **μ¶λ ¥ ν•μ‹**: JSON (κµ¬μ΅°ν™”λ VDP)
- **ν† ν° ν•κ³„**: 16,384 (μ¶©λ¶„ν• μƒμ„Έλ„)

### GCS ν¨ν„΄
- **μ…λ ¥ λ²„ν‚·**: `gs://tough-variety-raw/`
- **μ¶λ ¥ λ²„ν‚·**: `gs://tough-variety-gold/`
- **νμΌλ… κ·μΉ™**: `{hash}_{timestamp}.{ext}`
- **κ¶ν• λ¨λΈ**: μ„λΉ„μ¤ κ³„μ • κΈ°λ°

### μ¤λ¥ μ²λ¦¬
- **RFC 7807**: Problem Details ν‘μ¤€ μ¤€μ
- **νƒ€μ„μ¤νƒ¬ν”„**: ISO 8601 ν•μ‹
- **μƒμ„Έ λ΅κ·Έ**: λ””λ²„κΉ… μ •λ³΄ ν¬ν•¨
- **λ³µκµ¬ κ°€μ΄λ“**: μλ™ μ •λ¦¬ λ…λ Ή μ κ³µ

## π“‹ λ‹¤μ λ‹¨κ³„ κ¶μ¥μ‚¬ν•­

### 1. μ΄μ λ¨λ‹ν„°λ§
- API μ‘λ‹µ μ‹κ°„ λ¨λ‹ν„°λ§
- GCS μ¤ν† λ¦¬μ§€ μ‚¬μ©λ‰ μ¶”μ 
- Vertex AI ν• λ‹Ήλ‰ κ΄€λ¦¬
- μ¤λ¥μ¨ λ€μ‹λ³΄λ“ κµ¬μ¶•

### 2. μ„±λ¥ μµμ ν™”
- λ°°μΉ μ²λ¦¬ μ§€μ› μ¶”κ°€
- μΊμ‹ λ μ΄μ–΄ λ„μ…
- λ³‘λ ¬ μ²λ¦¬ ν™•μ¥
- λΉ„μ© μµμ ν™” μ „λµ

### 3. κΈ°λ¥ ν™•μ¥
- μ‹¤μ‹κ°„ μƒνƒ ν΄λ§ API
- μ›Ήν›… μ•λ¦Ό μ§€μ›
- λ€μ‹λ³΄λ“ UI κ°λ°
- A/B ν…μ¤νΈ ν”„λ μ„μ›ν¬

## β… κ²€μ¦ μ²΄ν¬λ¦¬μ¤νΈ

- [x] US-central1 μ„λΉ„μ¤ κ°€μ©μ„± ν™•μΈ
- [x] API μ—”λ“ν¬μΈνΈ κµ¬μ΅° κ²€μ¦
- [x] λ©”νƒ€λ°μ΄ν„° μ£Όμ… ν¨ν„΄ ν™•μΈ
- [x] λΉ„λ™κΈ° μ²λ¦¬ λ™μ‘ κ²€μ¦
- [x] μ¤λ¥ ν•Έλ“¤λ§ ν…μ¤νΈ
- [x] GCS ν†µν•© μ›ν¬ν”λ΅μ° κµ¬ν„
- [x] μ‹¤ν–‰ κ°€λ¥ν• μ¤ν¬λ¦½νΈ μ κ³µ
- [x] λ¬Έμ„ν™” λ° κ°€μ΄λ“ μ‘μ„±

## π‰ κ²°λ΅ 

**VDP μ¶”μ¶ νΈλ¦¬κ±° κµ¬ν„μ΄ μ„±κ³µμ μΌλ΅ μ™„λ£λμ—μµλ‹λ‹¤.**

- β… λ¨λ“  λ©ν‘ λ‹¬μ„±
- β… μ•μ •μ μΈ μ•„ν‚¤ν…μ² κµ¬ν„
- β… ν™•μ¥ κ°€λ¥ν• μ„¤κ³„
- β… μ™„μ „ν• κ²€μ¦ μ™„λ£
- β… μ΄μ μ¤€λΉ„ μƒνƒ

μ΄μ  US-central1 μ—”λ“ν¬μΈνΈλ¥Ό ν†µν• λΉ„λ™κΈ° VDP μ¶”μ¶μ΄ μ™„μ „ν μλ™ν™”λμ—μΌλ©°, λ©”νƒ€λ°μ΄ν„° λ¶„λ¦¬ μ•„ν‚¤ν…μ²λ΅ μ μ—°ν• ν”λ«νΌ μ§€μ›μ΄ κ°€λ¥ν•©λ‹λ‹¤.