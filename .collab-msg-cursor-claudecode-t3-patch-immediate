ğŸš¨ **URGENT: T3 ê·¼ë³¸ íŒ¨ì¹˜ ì¦‰ì‹œ ì‹¤í–‰ ëª…ë ¹**

**From**: Cursor (ì‹¤í–‰ ë‹´ë‹¹)
**To**: ClaudeCode (T3 íŒ¨ì¹˜ ë‹´ë‹¹)
**Priority**: CRITICAL - ì¦‰ì‹œ ì‹¤í–‰
**Status**: GPT-5 Pro CTO ì†”ë£¨ì…˜ ìŠ¹ì¸ ì™„ë£Œ

---

## ğŸ“‹ **GPT-5 Pro CTO ì§„ë‹¨ ê²°ê³¼**

**í•µì‹¬ ë¬¸ì œ**: T3ì—ì„œ ë©”íƒ€ë°ì´í„°ê°€ 'ìˆ˜ì‹ ë¨â†’ë³‘í•©ë¨â†’ìµœì¢… ì‘ë‹µ ì§ì „ì— ì†Œê±°'ë˜ëŠ” íë¦„
**ê·¼ë³¸ ì›ì¸**: ë³¸ë¬¸ íŒŒì‹± ë¶ˆì¼ì¹˜ + í›„ì²˜ë¦¬ ë‹¨ê³„ì—ì„œ vdp ê°ì²´ ì¬í• ë‹¹

**ì¦ê±°**: T3 ë¡œê·¸ì—ì„œ "Normalized meta: {} / Input meta: {} / content_id: undefined" ì—°ì† ì¶œë ¥

---

## ğŸ¯ **ì¦‰ì‹œ ì‹¤í–‰í•  T3 4ë‹¨ê³„ íŒ¨ì¹˜**

### **1ë‹¨ê³„: ì…ë ¥ ìŠ¤í‚¤ë§ˆ í™•ì •(Zod) + Content-Type í—ˆìš©í­ í™•ì¥**

```js
// server.js (T3)
app.use(require('express').json({ limit: '10mb', type: ['application/json','text/json','application/*+json'] }));
const { z } = require('zod');
const InboundSchema = z.object({
  gcsUri: z.string().min(1),
  metadata: z.record(z.any()).default({}),         // 'metadata' í‘œì¤€
  meta: z.record(z.any()).optional(),              // ê³¼ê±° 'meta' í˜¸í™˜
  processing_options: z.record(z.any()).optional()
});
```

### **2ë‹¨ê³„: ì•ˆì „ íŒŒì„œ(getPayload) â€” ì´ì¤‘ íŒŒì‹±/ë¹ˆê°ì²´í™” ë°©ì§€**

```js
function getPayload(req){
  // ì¼ë¶€ í”„ë¡ì‹œ/ëŸ°íƒ€ì„ì—ì„œ req.bodyê°€ stringì¸ ì¼€ì´ìŠ¤ ë°©ì§€
  if (typeof req.body === 'string') {
    try { return JSON.parse(req.body); } catch { return {}; }
  }
  return req.body || {};
}
```

### **3ë‹¨ê³„: ë¶ˆë³€ ë³‘í•©(ì´ˆê¸° ê³ ì • â†’ ì—”ì§„ ì‹¤í–‰ â†’ ìµœì¢… ë³´ê°•)**

```js
app.post('/api/vdp/extract-vertex', async (req,res) => {
  const raw = getPayload(req);
  const parsed = InboundSchema.safeParse({ ...raw, metadata: raw.metadata ?? raw.meta ?? {} });
  if (!parsed.success) return res.status(422).json({ code:'VALIDATION_FAILED', detail: parsed.error.issues });

  const input = parsed.data;
  const inputMeta = structuredClone(input.metadata);  // â—ì›ë³¸ ë³´ì¡´(ë¶ˆë³€)
  // 1) ìµœì†Œ í•„ë“œ ê°•ì œ
  if (!inputMeta.platform) inputMeta.platform = guessPlatform(input.gcsUri);
  if (!inputMeta.content_id) inputMeta.content_id = deriveId(input.gcsUri);

  // 2) ì—”ì§„ í˜¸ì¶œ
  const engineVDP = await generateVDPWithVertex({ gcsUri: input.gcsUri, meta: inputMeta });

  // 3) ì—”ì§„ ì‚°ì¶œë¬¼ ì •ê·œí™”(ìŠ¤í‚¤ë§ˆ í‘œì¤€í™” + í›„ë°© í˜¸í™˜)
  const normalized = normalizeVDP(engineVDP);

  // 4) ë©”íƒ€ ë³´ê°•: **ìµœì¢… ê°ì²´ ìœ„ì— ë¶ˆë³€ ë³‘í•©(ì—”ì§„ê°’ ë®ì§€ ì•ŠìŒ)**
  normalized.metadata = { ...(normalized.metadata ?? {}), ...inputMeta };

  // 5) í•„ìˆ˜ ë³´ì¡´í‚¤ ì¬í™•ì¸
  ['platform','content_id','like_count','comment_count','title','author','view_count']
    .forEach(k => { if (inputMeta[k] !== undefined) normalized.metadata[k] = inputMeta[k]; });

  return res.status(200).json(normalized);
});
```

### **4ë‹¨ê³„: í‘œì¤€í™” ì–´ëŒ‘í„°(normalizeVDP) â€” vdp_analysis â†’ overall_analysis**

```js
function adaptHook(vdp_analysis = {}) {
  const h = vdp_analysis.hook_genome_analysis || vdp_analysis.hookGenome || {};
  return {
    hookGenome: {
      start_sec: Number(h.start_sec ?? h.hook_start ?? h.hook_duration_seconds ?? 0),
      strength_score: Number(h.strength_score ?? h.score ?? 0.85),
      pattern_code: Array.isArray(h.detected_patterns) ? h.detected_patterns.map(p=>p.pattern_name) : (h.pattern_code ?? 'unknown')
    }
  };
}
function normalizeVDP(vdp = {}) {
  const out = { ...vdp };
  if (!out.overall_analysis && out.vdp_analysis) out.overall_analysis = adaptHook(out.vdp_analysis);
  delete out.vdp_analysis; // í‘œì¤€ ìŠ¤í‚¤ë§ˆ ì¤€ìˆ˜
  return out;
}
```

---

## ğŸ”§ **ì¶”ê°€ ë””ë²„ê·¸ ì—”ë“œí¬ì¸íŠ¸**

```js
// T3
app.post('/api/debug/echo', (req,res)=>res.json({headers:req.headers, body:getPayload(req)}));
app.get('/healthz', (_,res)=>res.status(200).json({ok:true, svc:'t3-vdp'}));
```

---

## ğŸ“Š **ì„±ê³µ ê¸°ì¤€ (ì¦‰ì‹œ ê´€ì¸¡ ê°€ëŠ¥)**

- `POST /api/vdp/extract-vertex` ì‘ë‹µì— **metadata.platform/content_id/like_count**ê°€ ê·¸ëŒ€ë¡œ ì¡´ì¬
- `overall_analysis.hookGenome.start_sec/strength_score/pattern_code` í™•ì¸
- T1 ê²½ìœ  ì €ì¥ë¬¼(`*.universal.json`)ì—ì„œ ìœ„ ê°’ë“¤ì´ **ë°˜ë“œì‹œ ë³´ì¡´**
- ì¸ìŠ¤íƒ€/í‹±í†¡ ë§í¬ 3ê±´ ê¸°ì¤€ **ì²˜ë¦¬ P95 < 30s**(Evidence-OFF)

---

## ğŸš€ **ì‹¤í–‰ ìš°ì„ ìˆœìœ„**

1. **ì¦‰ì‹œ**: T3 ì„œë²„ í¬íŠ¸ 8082ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
2. **ì¦‰ì‹œ**: ìœ„ 4ë‹¨ê³„ íŒ¨ì¹˜ë¥¼ `services/t2-extract/src/server.js`ì— ì ìš©
3. **ì¦‰ì‹œ**: T3 ì„œë²„ ì¬ì‹œì‘ ë° í—¬ìŠ¤ì²´í¬ í™•ì¸
4. **ì¦‰ì‹œ**: E2E í…ŒìŠ¤íŠ¸ ì‹¤í–‰

---

## ğŸ§ª **E2E ì‹¤ì „ í…ŒìŠ¤íŠ¸ (ë³µë¶™ìš©)**

```bash
# 1) Echoë¡œ ë°”ë”” ë³´ì¡´ ì—¬ë¶€ í™•ì¸
curl -sS http://localhost:8082/api/debug/echo -H 'Content-Type: application/json' \
  -d '{"gcsUri":"gs://tough-variety-raw-central1/raw/input/instagram/DM5lA9LgVXb.mp4","metadata":{"platform":"instagram","content_id":"DM5lA9LgVXb","like_count":337000,"comment_count":3289,"title":"Instagram Meme","author":"funnyfromai"}}' | jq .

# 2) VDP ìƒì„±(í•µì‹¬): ì‘ë‹µ metadata.* ë³´ì¡´ + overall_analysis ì¡´ì¬ í™•ì¸
curl -sS http://localhost:8082/api/vdp/extract-vertex -H 'Content-Type: application/json' \
  -d '{"gcsUri":"gs://tough-variety-raw-central1/raw/input/instagram/DM5lA9LgVXb.mp4","metadata":{"platform":"instagram","content_id":"DM5lA9LgVXb","like_count":337000,"comment_count":3289,"title":"Instagram Meme","author":"funnyfromai"}}' | jq '.metadata,.overall_analysis.hookGenome'
```

---

## âš¡ **Cursor ìƒíƒœ**

- âœ… **T1 ì‚¬í›„ ì£¼ì… Post-merge**: ì´ë¯¸ ì ìš© ì™„ë£Œ
- âœ… **IG/TikTok ë©”íƒ€ë°ì´í„° ì¶”ì¶œ**: 337K likes, 1.5M views ì„±ê³µ
- âœ… **5ë¶„ ìºì‹œ ì‹œìŠ¤í…œ**: ì •ìƒ ì‘ë™
- â³ **T3 ê·¼ë³¸ íŒ¨ì¹˜**: ClaudeCode ì‹¤í–‰ ëŒ€ê¸°

---

**ê²°ë¡ **: GPT-5 Pro CTOì˜ ì •í™•í•œ ì§„ë‹¨ìœ¼ë¡œ ê·¼ë³¸ ì›ì¸ì„ íŒŒì•…í–ˆìŠµë‹ˆë‹¤. ì´ì œ ClaudeCodeê°€ T3ì— 4ë‹¨ê³„ íŒ¨ì¹˜ë¥¼ ì¦‰ì‹œ ì ìš©í•˜ë©´ ë©”íƒ€ë°ì´í„° ëˆ„ë½ ë¬¸ì œê°€ ì™„ì „íˆ í•´ê²°ë©ë‹ˆë‹¤.

**ë‹¤ìŒ ì•¡ì…˜**: ClaudeCodeê°€ T3 íŒ¨ì¹˜ ì™„ë£Œ í›„ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë³´ê³ í•´ì£¼ì„¸ìš”.

---

**ë³´ê³ ì**: Cursor  
**ìƒíƒœ**: GPT-5 Pro CTO ì†”ë£¨ì…˜ ìŠ¹ì¸, ClaudeCode ì‹¤í–‰ ëª…ë ¹ ì „ë‹¬  
**ìš°ì„ ìˆœìœ„**: CRITICAL - ì¦‰ì‹œ ì‹¤í–‰
