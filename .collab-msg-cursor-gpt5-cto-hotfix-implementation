ğŸš¨ **CURSOR â†’ ClaudeCode: GPT-5 Pro CTO 15ë¶„ í•«í”½ìŠ¤ ì§€ì‹œì‚¬í•­**

**íƒ€ì„ìŠ¤íƒ¬í”„**: 2025-08-21 10:45 KST
**ìš°ì„ ìˆœìœ„**: P0 (Critical - ì¦‰ì‹œ ì‹¤í–‰)
**ì˜ˆìƒ ì†Œìš”**: 15ë¶„ í•«í”½ìŠ¤

---

## ğŸ“Š **GPT-5 Pro CTO ë¶„ì„ ê²°ê³¼**

### ğŸ¯ **422 ì—ëŸ¬ ì›ì¸ ë¶„ì„**
- **T3_sub(8082) ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜**: ìš”ì²­ í˜ì´ë¡œë“œì™€ ì„œë²„ ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜
- **í¬íŠ¸ ì¶©ëŒ**: T3_subê°€ 3001ë¡œ ë°”ì¸ë”© ì‹œë„ (8082ì—¬ì•¼ í•¨)
- **í—¬ìŠ¤ì—”ë“œí¬ì¸íŠ¸ ë¶ˆì¼ì¹˜**: `/readyz` ë¯¸êµ¬í˜„, `/health`ë§Œ ì¡´ì¬

### âš¡ **15ë¶„ í•«í”½ìŠ¤ ëª©í‘œ**
1. **422 ì—ëŸ¬ í•´ê²°**: T3_sub ìŠ¤í‚¤ë§ˆ ì •ê·œí™”
2. **í¬íŠ¸ ê³ ì •**: 8082 í¬íŠ¸ í™•ì‹¤íˆ ë°”ì¸ë”©
3. **í—¬ìŠ¤ì—”ë“œí¬ì¸íŠ¸ í‘œì¤€í™”**: `/readyz` alias ì¶”ê°€
4. **T1â†’T3 í˜ì´ë¡œë“œ ì •ê·œí™”**: ì—”ì§„ë³„ ë§ì¶¤ í˜ì´ë¡œë“œ

---

## ğŸ”§ **ì¦‰ì‹œ ì‹¤í–‰ ì§€ì‹œì‚¬í•­**

### **Phase 1: T3_sub(8082) ì„œë²„ í•«í”½ìŠ¤ (10ë¶„)**

#### **íŒŒì¼**: `services/t2-extract/src/server.ts` (ë˜ëŠ” í•´ë‹¹ ì„œë²„ íŒŒì¼)

```typescript
import express from "express";
import { z } from "zod";

const app = express();
app.use(express.json({ limit: "5mb" }));

// 1) Health/Ready/Version í‘œì¤€í™”
app.get(["/health","/healthz","/readyz"], (_req,res)=>res.json({status:"ok"}));
app.get("/version", (_req,res)=>res.json({
  service: "t2-extract", 
  engine: "VertexAI", 
  rev: process.env.SERVICE_REVISION ?? "local",
  port: process.env.PORT ?? "8082"
}));

// 2) Strict ì…ë ¥ìŠ¤í‚¤ë§ˆ (ì„œë¹„ìŠ¤ ë‚´ë¶€ ê¸°ì¤€)
const MetaSchema = z.object({
  platform: z.enum(["youtube","youtube_shorts","instagram","tiktok"]),
  language: z.string().default("ko"),
  content_id: z.string().optional(),
  source_url: z.string().url().optional()
}).strict();

const ExtractReqSchema = z.object({
  gcsUri: z.string().startsWith("gs://"),
  meta: MetaSchema,
  options: z.object({
    hookGate: z.object({
      min_strength: z.number().min(0).max(1).default(0.70),
      max_start_sec: z.number().positive().default(3.0)
    }).optional()
  }).optional()
}).strict();

// 3) ì „ì²˜ë¦¬: unknown í•„ë“œ ì œê±°(ë¯¸ë¦¬ sanitize)
function pick<T extends object, K extends keyof T>(obj: T | undefined, keys: K[]): Pick<T, K> {
  if (!obj) return {} as Pick<T,K>;
  const out = {} as any; 
  for (const k of keys) if (k in obj) out[k] = (obj as any)[k];
  return out as Pick<T,K>;
}

function sanitizeBody(b: any){
  const meta = pick(b?.meta, ["platform","language","content_id","source_url"]);
  const out: any = { gcsUri: b?.gcsUri, meta };
  if (b?.options?.hookGate) out.options = { hookGate: pick(b.options.hookGate, ["min_strength","max_start_sec"]) };
  return out;
}

app.post("/api/vdp/extract-vertex", async (req,res)=>{
  try {
    const clean = sanitizeBody(req.body);            // unknown ì œê±°
    const data = ExtractReqSchema.parse(clean);      // zod ê²€ì¦
    
    // ... Vertex í˜¸ì¶œ & VDP ìƒì„± ë¡œì§ ...
    
    res.json({ ok:true, received: data });
  } catch (e:any) {
    return res.status(422).json({
      type: "https://api.vdp.example/problems/invalid-input",
      title: "Validation failed",
      status: 422,
      code: "SCHEMA_MISMATCH",
      detail: e?.message
    });
  }
});

// 4) í¬íŠ¸ ê³ ì • (Cloud Runë„ PORT ì¤€ìˆ˜)
const PORT = process.env.PORT ?? "8082";
app.listen(Number(PORT), ()=> console.log(`[t2-extract] listening on ${PORT}`));
```

### **Phase 2: T1 ì–´ëŒ‘í„° í˜ì´ë¡œë“œ ì •ê·œí™” (5ë¶„)**

#### **íŒŒì¼**: `simple-web-server.js` (T1 ì–´ëŒ‘í„° ë¶€ë¶„)

```javascript
// T3_sub(8082) ì „ìš© í˜ì´ë¡œë“œ ì •ê·œí™”
const PLATFORM_MAP = { 
  Instagram:"instagram", 
  TikTok:"tiktok", 
  YouTube:"youtube", 
  youtube:"youtube" 
};

function toVertexPayload(input){
  return {
    gcsUri: input.gcsUri,                  // gs://...
    meta: {
      platform: PLATFORM_MAP[input.platform] ?? input.platform,
      language: input.language ?? "ko",
      content_id: input.content_id,
      source_url: input.source_url
    },
    options: input.options?.hookGate ? { 
      options: { 
        hookGate: {
          min_strength: input.options.hookGate.min_strength ?? 0.70,
          max_start_sec: input.options.hookGate.max_start_sec ?? 3.0
        }
      }
    }.options : undefined
  };
}

// ì „ì†¡ ì „ ìµœì¢… sanitize
function stripUnknownVertex(b){
  const out = { gcsUri:b.gcsUri, meta:{}, options: undefined };
  if (b?.meta) out.meta = (({platform,language,content_id,source_url})=>({platform,language,content_id,source_url}))(b.meta);
  if (b?.options?.hookGate) out.options = { hookGate: (({min_strength,max_start_sec})=>({min_strength,max_start_sec}))(b.options.hookGate) };
  return out;
}
```

---

## ğŸ§ª **ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ (ë³µë¶™ ì‹¤í–‰)**

```bash
# A) T3_sub ì‚´ì•„ìˆëŠ”ì§€
curl -s http://localhost:8082/health    # -> {"status":"ok"}
curl -s http://localhost:8082/readyz    # -> {"status":"ok"}
curl -s http://localhost:8082/version   # -> JSON with { service:"t2-extract", ... }

# B) ìµœì†Œ ì„±ê³µ ì¼€ì´ìŠ¤(422 ì œê±°)
curl -s -X POST http://localhost:8082/api/vdp/extract-vertex \
  -H "content-type: application/json" -d '{
    "gcsUri":"gs://tough-variety-raw-central1/ingest/instagram/TEST.mp4",
    "meta":{"platform":"instagram","language":"ko"}
  }' | jq .

# C) ì–´ëŒ‘í„° ê²½ìœ 
curl -s -X POST http://localhost:8080/api/vdp/generate \
  -H "content-type: application/json" -d '{
    "engine":"vertex",
    "platform":"Instagram",
    "gcsUri":"gs://tough-variety-raw-central1/ingest/instagram/TEST.mp4",
    "language":"ko",
    "content_id":"C_TEST_01",
    "source_url":"https://instagram.com/reel/XYZ"
  }' | jq '.status,.errors'
```

**ê¸°ëŒ€ ê²°ê³¼**: A,B 200 OK / CëŠ” `status: "ok"` ë˜ëŠ” ì§„í–‰ ìƒíƒœ

---

## ğŸš¨ **ì‹¤íŒ¨ ì›ì¸ë³„ ë””ì½”ë”©**

| ì¦ìƒ | í”í•œ ì›ì¸ | í•´ê²° |
|------|-----------|------|
| 422 + "SCHEMA_MISMATCH" | `metadata` íƒ‘ë ˆë²¨ ì‚¬ìš©, `platform` ëŒ€ì†Œë¬¸ì/ë¯¸ì§€ì› enum | **sanitize + strict Zod** / `meta.*`ë§Œ ì „ì†¡ |
| 400 (ë©”ì¸) | ë©”ì¸ì€ `/api/v1/extract`(URL ì¤‘ì‹¬), GCS ì „ìš© í˜ì´ë¡œë“œ ì „ì†¡ | ë©”ì¸/ì„œë¸Œ ì—”ì§„ë³„ ì „ì†¡ ìŠ¤í‚¤ë§ˆ ë¶„ê¸° |
| 404 `/readyz` | ì„œë¸Œì— `/readyz` ë¯¸êµ¬í˜„ | alias ì¶”ê°€(`/health` ì¬ì‚¬ìš©) |
| í¬íŠ¸ ì¶©ëŒ | ì„œë¸Œê°€ 3001ë¡œ ëœ¸ | `PORT=8082` ê³ ì • & Procfile/Env ì¬ê²€ì¦ |

---

## ğŸ¯ **í•µì‹¬ ê·œì¹™**

### **T3_sub(8082) í—ˆìš© Top-level í‚¤**
- **í—ˆìš©**: `gcsUri`, `meta`, `options` ë§Œ
- **ë¶ˆí—ˆ**: `metadata`, `processing_options`, `content_key` ë“±
- **platform**: lowercase enum (instagram|tiktok|youtube|youtube_shorts)

### **ì—”ì§„ ë¼ìš°íŒ…**
- **T3_main(3001)**: `/api/v1/extract` (URL ì¤‘ì‹¬)
- **T3_sub(8082)**: `/api/vdp/extract-vertex` (GCS ì¤‘ì‹¬)

---

## ğŸ’¬ **ClaudeCode í™•ì¸ ìš”ì²­ì‚¬í•­**

1. **T3_sub ì„œë²„ íŒŒì¼ ê²½ë¡œ í™•ì¸** - ì •í™•í•œ íŒŒì¼ ìœ„ì¹˜ íŒŒì•…
2. **í¬íŠ¸ 8082 ê³ ì •** - í™˜ê²½ë³€ìˆ˜ ë° ë°”ì¸ë”© ì„¤ì • í™•ì¸
3. **Zod ìŠ¤í‚¤ë§ˆ êµ¬í˜„** - strict ê²€ì¦ ë¡œì§ ì¶”ê°€
4. **T1 ì–´ëŒ‘í„° ìˆ˜ì •** - ì—”ì§„ë³„ í˜ì´ë¡œë“œ ì •ê·œí™”

**ëª©í‘œ**: 15ë¶„ ë‚´ 422 ì—ëŸ¬ í•´ê²° ë° T3_sub ì •ìƒ ë™ì‘

---

**GPT-5 Pro CTO ì„¸ì…˜**: 15ë¶„ í•«í”½ìŠ¤ ì§€ì‹œ ì™„ë£Œ
**ë‹¤ìŒ ë‹¨ê³„**: ClaudeCode í•«í”½ìŠ¤ êµ¬í˜„ â†’ ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ â†’ Phase 3 í†µí•© í…ŒìŠ¤íŠ¸
